# مستندات پروژه تحقیقاتی

## هدف از کد

این پروژه به‌عنوان یک نمونه ساده و مینیمال از WebAssembly (WASM) طراحی شده است. هدف اصلی آن، مقایسه عملکرد سه روش مختلف برای اعمال فیلتر خاکستری (Grayscale) به تصاویر است: پیاده‌سازی بومی جاوااسکریپت (JS)، Rust کامپایل‌شده به WebAssembly (WASM) و یک سرور API مبتنی بر Rust. هدف، ارزیابی و مقایسه سرعت اجرای این روش‌ها در محیط وب است تا بینش‌هایی در مورد کارایی آن‌ها برای وظایف پردازش تصویر فراهم شود. این مقایسه به‌ویژه برای درک تفاوت‌های بین پردازش سمت کلاینت (JS و WASM) و پردازش سمت سرور (API Rust) از نظر سرعت، مقیاس‌پذیری و کاربرد عملی در یک برنامه وب مبتنی بر React مفید است.

این پروژه به‌عنوان یک نمونه اولیه (Proof-of-Concept) برای موارد زیر عمل می‌کند:
- **نمونه‌ای مناسب و مینیمال از معماری پروژه WASM**: این پروژه در درجه اول با هدف نشان دادن نحوه شروع برنامه‌نویسی با WASM طراحی شده است و از یک پروژه کوچک به‌عنوان مثال استفاده می‌کند.
- **مقایسه زمان‌های اجرا**: اندازه‌گیری مدت‌زمان پردازش تصاویر با اندازه‌های مختلف توسط هر یک از روش‌ها (JS Native، Rust WASM، Rust API).
- **اثبات کارایی**: نشان دادن اینکه آیا راه‌حل‌های مبتنی بر Rust (WASM یا API) نسبت به پیاده‌سازی خالص جاوااسکریپت برای وظایف محاسباتی سنگین مانند پردازش تصویر برتری عملکردی دارند.
- **نمایش نتایج**: استفاده از نمودارها برای نمایش زمان‌های پردازش تصاویر به‌صورت جداگانه و میانگین آن‌ها، به‌منظور تحلیل آسان‌تر تفاوت‌های عملکرد.

عملکرد آزمایشی پروژه، مجموعه‌ای از تصاویر موجود در پوشه `test` را پردازش می‌کند، هر سه روش خاکستری‌سازی را روی هر تصویر اعمال می‌کند، زمان صرف‌شده را ثبت می‌کند و نتایج را در قالب نمودارهای میله‌ای (یکی برای زمان‌های هر تصویر و دیگری برای میانگین زمان‌ها در کل تصاویر) نمایش می‌دهد. این کار به شناسایی بهترین روش تحت شرایط مختلف کمک می‌کند.

## ساختار پروژه

پروژه به دو بخش اصلی تقسیم می‌شود: بخش فرانت‌اند (برنامه وب مبتنی بر React) و بخش بک‌اند (سرور وب مبتنی بر Rust). ساختار پروژه به‌صورت زیر است:

```
research_project/
├── frontend/
│   ├── src/
│   │   ├── wasm_module/        # کد Rust برای ماژول WASM
│   │   │   ├── src/           # فایل‌های منبع Rust برای فیلتر خاکستری WASM
│   │   │   ├── Cargo.toml     # پیکربندی Rust برای ماژول WASM
│   │   │   └── pkg/           # خروجی WASM تولیدشده (پس از ساخت با wasm-pack)
│   │   ├── test/              # پوشه حاوی تصاویر آزمایشی (مثل .jpg، .png)
│   │   ├── App.js             # کامپوننت اصلی React با منطق پردازش تصویر
│   │   ├── index.js           # نقطه ورودی React
│   │   ├── package.json       # وابستگی‌ها و اسکریپت‌های Node.js
│   │   └── ...                # سایر فایل‌های مرتبط با React (مثل public/، node_modules/)
├── web_server/
│   ├── src/                   # فایل‌های منبع Rust برای سرور وب
│   ├── Cargo.toml             # پیکربندی Rust برای سرور وب
│   └── ...                    # سایر فایل‌های مرتبط با سرور (مثل فایل‌های باینری کامپایل‌شده)
```

- **frontend/src/wasm_module**: حاوی کد Rust است که فیلتر خاکستری را پیاده‌سازی می‌کند و با استفاده از `wasm-pack` به WebAssembly کامپایل می‌شود. پوشه `pkg/` پس از ساخت تولید شده و شامل فایل باینری WASM و کد چسب جاوااسکریپت است.
- **frontend/src/test**: پوشه‌ای حاوی تصاویر آزمایشی (مثل JPG، PNG) که برای آزمایش عملکرد سه روش استفاده می‌شود.
- **frontend/src/App.js**: کامپوننت اصلی React که انتخاب تصویر، اعمال فیلترهای خاکستری (JS، WASM یا API)، اجرای آزمایش‌ها و نمایش نتایج در قالب نمودارهای میله‌ای با استفاده از کتابخانه `recharts` را مدیریت می‌کند.
- **web_server**: سرور وب مبتنی بر Rust که یک endpoint (`/filter`) را برای دریافت تصاویر، اعمال فیلتر خاکستری و بازگرداندن تصویر پردازش‌شده ارائه می‌دهد. این بخش سناریوی پردازش سمت سرور را شبیه‌سازی می‌کند.

## نحوه کار آزمایش

عملکرد آزمایشی با کلیک روی دکمه "آزمایش" در برنامه React فعال می‌شود. نحوه کار به‌صورت زیر است:

1. **بارگذاری تصاویر**:
   - آزمایش از `require.context` برای بارگذاری پویا تمام تصاویر موجود در پوشه `frontend/src/test` با فرمت‌های پشتیبانی‌شده (مثل `.jpg`، `.png`، `.gif`، `.webp` و غیره) استفاده می‌کند.
   - هر تصویر در یک canvas موقت برای پردازش بارگذاری می‌شود.

2. **پردازش هر تصویر**:
   - برای هر تصویر، سه فیلتر خاکستری به‌صورت متوالی اعمال می‌شود:
     - **JS Native**: یک تابع جاوااسکریپت (`jsGrayscale`) که داده‌های پیکسل تصویر را مستقیماً در مرورگر پردازش کرده و میانگین مقادیر RGB هر پیکسل را محاسبه می‌کند.
     - **Rust WASM**: یک تابع Rust (`grayscale`) که به WebAssembly کامپایل شده است، از طریق ماژول WASM فراخوانی شده، داده‌های پیکسل را پردازش کرده و نتیجه را به مرورگر بازمی‌گرداند.
     - **Rust API**: تصویر را از طریق درخواست POST به سرور وب Rust در آدرس `http://127.0.0.1:8080/filter` ارسال می‌کند، تصویر خاکستری‌شده را دریافت کرده و زمان رفت‌وبرگشت را اندازه‌گیری می‌کند.
   - زمان صرف‌شده برای هر روش با استفاده از `performance.now()` در واحد میلی‌ثانیه ثبت می‌شود.

3. **ذخیره نتایج**:
   - نتایج هر تصویر (نام تصویر، زمان JS، زمان WASM، زمان API) در آرایه حالت `testResults` ذخیره می‌شود.

4. **نمایش نتایج**:
   - پس از پردازش تمام تصاویر، دو نمودار میله‌ای نمایش داده می‌شود:
     - **زمان هر تصویر**: زمان پردازش (در میلی‌ثانیه) برای هر تصویر در هر سه روش (JS، WASM، API) را نشان می‌دهد. محور X نام تصاویر و محور Y زمان را نشان می‌دهد.
     - **میانگین زمان‌ها**: میانگین زمان پردازش برای هر روش در کل تصاویر را در یک نمودار میله‌ای واحد نمایش می‌دهد.
   - نمودارها با استفاده از کتابخانه `recharts` رندر می‌شوند و با کلیک روی دکمه "بستن نمودارها" می‌توان آن‌ها را مخفی کرد.

5. **مدیریت خطاها**:
   - در صورت عدم بارگذاری تصویر یا در دسترس نبودن سرور API Rust، خطاها در کنسول ثبت شده و آزمایش با تصویر بعدی ادامه می‌یابد.

این آزمایش امکان مقایسه مستقیم سه روش را فراهم می‌کند و تفاوت‌های عملکرد ناشی از کارایی محاسباتی (JS در مقابل WASM) و سربار شبکه (API) را برجسته می‌کند.

## دستورالعمل‌های ساخت و اجرای پروژه

### پیش‌نیازها
برای اجرای پروژه، اطمینان حاصل کنید که موارد زیر نصب شده‌اند:
- **Node.js** (نسخه 14 یا بالاتر): برای اجرای برنامه React.
- **npm** (همراه با Node.js): برای مدیریت وابستگی‌های فرانت‌اند.
- **Rust** (آخرین نسخه پایدار): برای ساخت ماژول WASM و سرور وب.
- **wasm-pack**: برای کامپایل Rust به WebAssembly. نصب با:
  ```bash
  cargo install wasm-pack
  ```
- **مرورگر وب**: برای دسترسی به برنامه React (مثل Chrome، Firefox).
- **Cargo** (همراه با Rust): برای ساخت و اجرای سرور وب Rust.
- **Git** (اختیاری): برای کلون کردن مخزن پروژه در صورت نیاز.

اطمینان حاصل کنید که پوشه `frontend/src/test` حاوی تصاویر آزمایشی (مثل `.jpg`، `.png`) باشد تا عملکرد آزمایشی کار کند.

### دستورالعمل‌های گام‌به‌گام

1. **ساخت ماژول WASM**:
   - به پوشه ماژول WASM بروید:
     ```bash
     cd frontend/src/wasm_module
     ```
   - کد Rust را به ماژول WebAssembly کامپایل کنید:
     ```bash
     wasm-pack build --target web
     ```
   - این کار پوشه `pkg/` را تولید می‌کند که شامل فایل باینری WASM و کد چسب جاوااسکریپت است.

2. **ساخت و اجرای سرور وب Rust**:
   - به پوشه سرور وب بروید:
     ```bash
     cd web_server
     ```
   - سرور وب Rust را بسازید:
     ```bash
     cargo build
     ```
   - سرور وب را اجرا کنید:
     ```bash
     cargo run
     ```
   - سرور باید روی `http://127.0.0.1:8080` شروع به کار کند. اطمینان حاصل کنید که قبل از استفاده از فیلتر Rust API یا اجرای آزمایش‌ها، سرور در حال اجرا باشد.

3. **ساخت و اجرای برنامه React**:
   - به پوشه فرانت‌اند بروید:
     ```bash
     cd frontend
     ```
   - وابستگی‌ها را نصب کنید:
     ```bash
     npm install
     ```
   - سرور توسعه React را اجرا کنید:
     ```bash
     npm run start
     ```
   - برنامه باید در مرورگر پیش‌فرض شما روی `http://localhost:3000` (یا پورت دیگری در صورت استفاده از 3000) باز شود.

### اجرای برنامه
- **پردازش دستی تصویر**:
  - برنامه React را در مرورگر باز کنید.
  - روی "انتخاب تصویر" کلیک کنید تا یک تصویر از رایانه خود آپلود کنید.
  - از دکمه‌های "JS Native"، "Rust WASM" یا "Rust API" برای اعمال فیلتر خاکستری استفاده کنید.
  - زمان پردازش نمایش داده می‌شود و می‌توانید تصویر فیلترشده را دانلود کنید.

- **اجرای آزمایش‌ها**:
  - اطمینان حاصل کنید که سرور وب Rust در حال اجرا است.
  - روی دکمه "آزمایش" کلیک کنید تا تمام تصاویر در پوشه `frontend/src/test` پردازش شوند.
  - پس از اتمام، نمودارهای میله‌ای زمان‌های پردازش هر تصویر و میانگین زمان‌ها در کل تصاویر را نمایش می‌دهند.
  - با کلیک روی "بستن نمودارها" می‌توانید نمودارها را مخفی کنید.

### عیب‌یابی
- **شکست ماژول WASM**: اطمینان حاصل کنید که `wasm-pack` نصب شده و پوشه `wasm_module` حاوی کد Rust معتبر با فایل `Cargo.toml` است.
- **خطاهای Rust API**: بررسی کنید که سرور Rust روی `http://127.0.0.1:8080` در حال اجرا باشد. در صورت بروز مشکل CORS، سرور را برای اجازه درخواست از `http://localhost:3000` پیکربندی کنید.
- **عدم نمایش نمودارها**: اطمینان حاصل کنید که `recharts` نصب شده است (`npm install recharts`) و پوشه `test` حاوی تصاویر است.
- **خالی بودن پوشه تست**: تصاویر را به پوشه `frontend/src/test` اضافه کنید تا عملکرد آزمایشی فعال شود.

## خلاصه نیازمندی‌ها
- **سخت‌افزار**: بدون نیازهای خاص.
- **سیستم‌عامل**: سیستم‌های مبتنی بر یونیکس توصیه می‌شوند.
- **نرم‌افزار**:
  - Node.js (نسخه 14+)
  - npm (نسخه 6+)
  - Rust (آخرین نسخه پایدار)
  - wasm-pack
  - مرورگر وب
- **وابستگی‌ها** (برای React):
  - `recharts` (برای نمودارها)
  - سایر وابستگی‌ها در `frontend/package.json`
- **شبکه**: سرور وب Rust باید روی `http://127.0.0.1:8080` برای آزمایش‌های API در دسترس باشد.
- **تصاویر آزمایشی**: حداقل یک تصویر در `frontend/src/test` برای آزمایش.

این مستندات باید به شما در درک، ساخت و اجرای پروژه کمک کند. اگر نیاز به توضیحات بیشتر یا جزئیات اضافی دارید، اطلاع دهید!
